<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type">
    <title>Fractal Explorer</title>
<style>
  *{ padding: 0; margin: 0; border: 0; }
  body { overflow: hidden; }
</style>
<script id="vertex-shader" type="x-shader/x-vertex">
attribute vec2 vPosition;

void
main()
{
    gl_Position = vec4(vPosition, 1.0, 1.0);
}
</script>
<script id="fragment-shader" type="x-shader/x-fragment">

precision mediump float;

uniform vec2 bottomLeft;
uniform float pixelSize;
uniform float lerpAmount;
uniform vec2 julia;

// uniform vec3 colors[84];

// uniform sampler2D sampler;

const int MAX_ITERATIONS = 1000;

//FUNCTIONS
void mult(in vec2 a, in vec2 b, out vec2 answer){
  answer = vec2( a.x*b.x - a.y*b.y, a.x*b.y + a.y*b.x);
}

void add(in vec2 a, in vec2 b, out vec2 answer){
  answer = vec2( a.x + b.x, a.y + b.y );
}

void magsqr(in vec2 a, out float answer){
  answer = a.x*a.x +a.y*a.y;
}

//MAIN
void
main()
{

  vec2 c = vec2(
    bottomLeft.x + pixelSize*gl_FragCoord.x,
    bottomLeft.y + pixelSize*gl_FragCoord.y
  );
  vec2 z = c;

  c = mix(c, julia, lerpAmount);

  int iterations = 0;
  for(int i = 0; i < MAX_ITERATIONS; ++i){
    mult(z, z, z);
    add(z, c, z);

    float magnitudeSqr;
    magsqr(z, magnitudeSqr);
    if( magnitudeSqr > 4.0 ){
      break;
    }

    ++iterations;
  }

  // if(iterations == MAX_ITERATIONS){
  //   gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);
  // }
  // else{
  //   gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
  // }



  // gl_FragColor = vec4(colors[1], 1.0);


  float percent = float(float(iterations)/float(MAX_ITERATIONS));
  percent = sqrt(percent);
  if(percent < 0.333){
    gl_FragColor = vec4(percent*2.4, 0.0, 0.0, 1.0);
  }
  else if(percent < 0.666){
    gl_FragColor = vec4(0.8 + (percent-0.333)/1.7, (percent-0.333)*2.4, 0.0, 1.0);
  }
  else{
    gl_FragColor = vec4(0.99, 0.8 + (percent-0.666)/1.7, (percent-0.666)*3.0, 1.0 );
  }

  // gl_FragColor = texture2D( sampler, vec2(iterations/MAX_ITERATIONS , 0.0) );
  // gl_FragColor = texture2D( sampler, vec2(1 , 1.0) );

}


</script>
<script type="text/javascript" src="webgl-utils.js"></script>
<script type="text/javascript" src="initShaders.js"></script>
<script type="text/javascript" src="MV.js"></script>
<script type="text/javascript" src="mandel.js"></script>
  </head>
  <body onresize="windowResize()">
    <canvas id="gl-canvas">
      Oops ... your browser doesn't support the HTML5 canvas element
    </canvas>

    <button class="btn" onclick="resetBtn()" type="button" style="padding-left: 30px; padding-right: 30px;" id="resetBtn">Reset</button>

    <button class="btn" onclick="zoomInBtn()" type="button" style="padding-left: 30px; padding-right: 30px;" id="zoomInBtn">Zoom In</button>

    <button class="btn" onclick="zoomOutBtn()" type="button" style="padding-left: 30px; padding-right: 30px;" id="zoomOutBtn">Zoom Out</button>

    <button class="btn" onclick="mandelBtn()" type="button" style="padding-left: 30px; padding-right: 30px;" id="mandelBtn">MANDELBROT</button>

    <button class="btn" onclick="juliaBtn()" type="button" style="padding-left: 30px; padding-right: 30px;" id="juliaBtn">JULIA</button>

    <image src="textureOne.png" id="textureOne" width="0px" height = "0px"></image>
  </body>
</html>
